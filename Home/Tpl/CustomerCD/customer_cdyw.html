<head>
    <meta charset="utf-8">
    <meta yywjtp-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->

    <!-- Bootstrap -->
    <!-- 引入uploadify样式 -->
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/uploadify/uploadify.css">
    <link href="__PUBLIC__/bootstrap-3.3.4/css/bootstrap.min.css" rel="stylesheet">
    <script language="javascript" type="text/javascript"
            src="__PUBLIC__/DateSelect/My97DatePicker/WdatePicker.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="yywjtp://cdn.bootcss.com/yywjml5shiv/3.7.2/yywjml5shiv.min.js"></script>
    <script language="javascript" type="text/javascript"
            src="__PUBLIC__/DateSelect/My97DatePicker/WdatePicker.js"></script>
    <script src="yywjtp://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <script src="__PUBLIC__/processbar/nprogress.js"></script>
    <link href="__PUBLIC__/processbar/nprogress.css" rel="stylesheet">
    <![endif]-->
    <script src="__PUBLIC__/processbar/nprogress.js"></script>
    <link href="__PUBLIC__/processbar/nprogress.css" rel="stylesheet">
    <style>
        .t-bg {
            background-color: #f4f4f4;
            font-weight: bold;
        }

        .t-color {
            border-bottom: 4px solid #4499ee;

        }

        .uploadify {
            position: relative;
            margin-bottom: 1em;
        }

        .uploadify-button {
            background-color: #505050;
            background-image: linear-gradient(bottom, #505050 0%, #707070 100%);
            background-image: -o-linear-gradient(bottom, #505050 0%, #707070 100%);
            background-image: -moz-linear-gradient(bottom, #505050 0%, #707070 100%);
            background-image: -webkit-linear-gradient(bottom, #505050 0%, #707070 100%);
            background-image: -ms-linear-gradient(bottom, #505050 0%, #707070 100%);
            background-image: -webkit-gradient(
                    linear,
                    left bottom,
                    left top,
                    color-stop(0, #505050),
                    color-stop(1, #707070)
            );
            background-position: center top;
            background-repeat: no-repeat;
            -webkit-border-radius: 30px;
            -moz-border-radius: 30px;
            border-radius: 30px;
            border: 2px solid #808080;
            color: #FFF;
            font: bold 12px Arial, Helvetica, sans-serif;
            text-align: center;
            text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.25);
            width: 100%;
        }

        .uploadify:hover .uploadify-button {
            background-color: #606060;
            background-image: linear-gradient(top, #606060 0%, #808080 100%);
            background-image: -o-linear-gradient(top, #606060 0%, #808080 100%);
            background-image: -moz-linear-gradient(top, #606060 0%, #808080 100%);
            background-image: -webkit-linear-gradient(top, #606060 0%, #808080 100%);
            background-image: -ms-linear-gradient(top, #606060 0%, #808080 100%);
            background-image: -webkit-gradient(
                    linear,
                    left bottom,
                    left top,
                    color-stop(0, #606060),
                    color-stop(1, #808080)
            );
            background-position: center bottom;
        }

        .uploadify-button.disabled {
            background-color: #D0D0D0;
            color: #808080;
        }

        .uploadify-queue {
            margin-bottom: 1em;
        }

        .uploadify-queue-item {
            background-color: #F5F5F5;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
            font: 11px Verdana, Geneva, sans-serif;
            margin-top: 5px;
            max-width: 350px;
            padding: 10px;
        }

        .uploadify-error {
            background-color: #FDE5DD !important;
        }

        .uploadify-queue-item .cancel a {
            background: url('../img/uploadify-cancel.png') 0 0 no-repeat;
            float: right;
            heigyywj: 16px;
            text-indent: -9999px;
            width: 16px;
        }

        .uploadify-queue-item.completed {
            background-color: #E5E5E5;
        }

        .uploadify-progress {
            background-color: #E5E5E5;
            margin-top: 10px;
            width: 100%;
        }

        .uploadify-progress-bar {
            background-color: #0099FF;
            heigyywj: 3px;
            width: 1px;
        }

        .container1 {
            text-align: center;
        }

        .yywj_box {
            padding: 9px 14px;
            margin-bottom: 14px;
            background-color: #f7f7f9;
            border: 1px solid #e1e1e8;
            border-radius: 4px;
            min-height: 200px;
        }

        .img {
            text-align: center;
            display: inline-block;
            margin: auto;
            max-width: 150px;
            max-heigyywj: 200px;
            padding: 4px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .img_ctrl {
            text-align: center;
            display: inline-block;
            /*position: absolute;*/
            width: 100%;
            /*heigyywj: auto;*/
            padding: 1px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 4px;
        }

        .img_name {
            display: none;
            position: absolute;
            z-index: 2;
        }

        .modal-content {
            text-align: center;
        }

        #img_show {
            max-width: 100%;
        }

        #fileselect {
            display: none;
        }

        #send-btn {
            cursor: pointer;
            display: block;
            margin: 10px;
            width: 120px;
        }
    </style>
</head>
<include file="Public:customer_header" title="车贷业务信息录入"/>
<script type="text/javascript" src="__PUBLIC__/validate/js/jquery-1.8.3-min.js"></script>
<!--<script type="text/javascript" src="__PUBLIC__/validate/js/jquery.validate.js"></script>-->
<!--<script type="text/javascript" src="__PUBLIC__/validate/js/jquery.metadata.js"></script>-->
<!--<script type="text/javascript" src="__PUBLIC__/validate/js/CardId.js"></script>-->
<script>
    function hascustomer() {
        if ($('input[name = cd_name]').val() != null && $('input[name = cd_name]').val() != '' && $('input[name = cd_cardid]').val() != null && $('input[name = cd_cardid]').val() != '') {
            $.post('<{:U("Customercd/hascustomer",null,false)}>', {
                xm: $('input[name = cd_name]').val(),
                sfzh: $('input[name = cd_cardid]').val()
            }, function (data) {
                var b1 = "<button type='button' class='btn btn-primary' onclick='openbasicinfo(" + data.id + ")'>查看客户基础信息</button>";
                if (data['status'] == 0) {
                    customernull.innerHTML = "该客户基础已录入" + b1;
                } else if (data['status'] == 1) {
                    customernull.innerHTML = "该客户基础信息不存在，请检查信息是否正确";
                } else {
                    customernull.innerHTML = "该客户基础资料已被删除，请联系管理员恢复";
                }
            });
        } else {
            customernull.innerHTML = "请填写客户资料";
        }
    }

    function openbasicinfo(id) {
        windowopen = window.open('__APP__/Customercd/customer_cd_update/id/' + id + '/enter/1', 'newwindow', 'height=900, width=600, top=0, left=0, toolbar=no, menubar=no, scrollbars=yes, resizable=no,location=no, status=no');
    }

    function recoverycustomer(c_id, type) {
        $.ajax({
            url: '<{:U("Customer/recoverycustomer",null,false)}>',
            type: 'POST',
            // dataType: 'default: Intelligent Guess (Other values: xml, json, script, or html)',
            data: {
                c_id: c_id
            },
            success: function (data) {
                if (!data['status']) {
                    alert("该客户已恢复")
                } else {
                    alert("该客户恢复失败，请联系管理员")
                }
            }
        })
    }
</script>
<script>
    $(document).ready(function () {
        var menuParent = $('.menu > .ListTitlePanel > div');//获取menu下的父层的DIV
        var menuList = $('.menuList');
        var history = 0;
        $(menuList[history]).show();
        $('.menu > .menuParent > .ListTitlePanel > .ListTitle').each(function (i) {//获取列表的大标题并遍历
            $(this).click(function () {
                if ($(menuList[i]).css('display') == 'none') {
                    $(menuList[i]).slideDown(300);
                    $(menuList[history]).hide();
                    $(menuList[i]).slideDown(300);
                    history = i;
                }
            });
        });
    });

    function callx() {
        $.post("<{:U('Index/remotecallx')}>", {
            startdate: $('#cd_dkffr').val(),
            money: $('input[name = cd_dkje]').val(),
            lv: $('input[name = cd_dkbl]').val() / 1000,
            type: $('input[name = cd_hkfs]:checked').val(),
            enddate: $('#cd_dkdqr').val(),
        }, function (returndata) {
            if (returndata.status) {
                document.getElementById('lxze').value = returndata.lxze + "万元";
                document.getElementById('ljhkze').value = returndata.ljhkze + "万元";
            }
        })
    }
</script>
<script type="text/javascript" src="__PUBLIC__/validate/js/cdyw.js"></script>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/validate/css/register.css"/>
<div class="module_public_main">
    <div class="modal fade bs-example-modal-lg" id="modal" tabindex="-1" role="dialog"
         aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <!-- <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button> -->
                <img id="img_show" src="" alt="">
            </div>
        </div>
    </div>
    <form id="cdyw_form">
        <div class="menu">
            <table align="left">
                <table align="left">
                    <tr>
                        <td width="20%" align="right" class="t-bg">客户姓名</td>
                        <td><input style="width: 200px" type="text" name="cd_name" class="_input"
                                   onblur="hascustomer()"/></td>
                    </tr>
                    <tr>
                        <td width="20%" align="right" class="t-bg">客户身份证</td>
                        <td><input style="width: 200px" type="text" name="cd_cardid" class="_input"
                                   onblur="hascustomer()"/></td>
                        <font style="color: red; font-size: 12px;" mce_style="color: red; font-size: 12px;"
                              id="customernull"></font>
                    </tr>
                </table>
                <div class="menuParent">
                    <div class="ListTitlePanel">
                        <div class="ListTitle">
                            <table align="right">
                                <tr style="background:url(__PUBLIC__/Images/t-bg.png)">


                                    <td width="20%" align="center"><b>车辆信息</b></td>

                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="menuList" style="display: none;">
                        <table align="left" id="clxx">
                            <tr>
                                <td width="20%" align="right" class="t-bg">车辆品牌型号</td>
                                <td><input style="width: 200px" type="text" name="cd_clppxh" class="_input"
                                           onblur="checkcd_clppxh()"/>
                                    <font
                                            style="color: red; font-size: 12px;"
                                            mce_style="color: red; font-size: 12px;"
                                            id="cd_clppxh"></font>
                                </td>
                                <td width="20%" align="right" class="t-bg">车牌号</td>
                                <td><input style="width: 200px" type="text" name="cd_cph" class="_input"
                                           onblur="checkcd_cph()"/>
                                    <font
                                            style="color: red; font-size: 12px;"
                                            mce_style="color: red; font-size: 12px;"
                                            id="cd_cph"></font>
                                </td>
                            </tr>
                            <tr>
                                <td width="20%" align="right" class="t-bg">车架号</td>
                                <td><input style="width: 200px" type="text" name="cd_djh" class="_input"
                                           onblur="checkcd_djh()"/>
                                    <font
                                            style="color: red; font-size: 12px;"
                                            mce_style="color: red; font-size: 12px;"
                                            id="cd_djh"></font>
                                </td>
                                <td width="20%" align="right" class="t-bg">车辆颜色</td>
                                <td><input style="width: 200px" type="text" name="cd_clys" class="_input"
                                           onblur="checkcd_clys()"/>
                                    <font
                                            style="color: red; font-size: 12px;"
                                            mce_style="color: red; font-size: 12px;"
                                            id="cd_clys"></font>
                                </td>
                            </tr>
                            <tr>
                                <td width="20%" align="right" class="t-bg">封籍日期</td>
                                <td><input style="width: 200px" name="cd_fjrq" class="_input Wdate" type="text"
                                           style="width:200px" readonly
                                           onFocus="WdatePicker()" onblur="checkcd_fjrq()">
                                    <font
                                            style="color: red; font-size: 12px;"
                                            mce_style="color: red; font-size: 12px;"
                                            id="cd_fjrq"></font>
                                </td>
                                <td width="20%" align="right" class="t-bg">垫款信息（注：个人转账，4s店转账，现金（备注））</td>
                                <td><input style="width: 200px" type="text" name="cd_dkxx" class="_input"
                                           onblur="checkcd_dkxx()"/>
                                    <font
                                            style="color: red; font-size: 12px;"
                                            mce_style="color: red; font-size: 12px;"
                                            id="cd_dkxx"></font>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="menuParent">
                    <div class="ListTitlePanel">
                        <div class="ListTitle">
                            <table align="left">
                                <tr style="background:url(__PUBLIC__/Images/t-bg.png)">
                                    <td width="20%" align="center"><b>保险信息</b></td>

                                </tr>
                            </table>
                            <div class="leftbgbt"></div>
                        </div>
                    </div>
                    <div class="menuList" style="display: none;">
                        <table align="left" id="bxxx">
                            <tr>
                                <td width="20%" align="right" class="t-bg">保险公司名称</td>
                                <td><input style="width: 200px" type="text" name="cd_bxgsmc" class="_input"
                                           onblur="checkcd_bxgsmc()"/>
                                    <font
                                            style="color: red; font-size: 12px;"
                                            mce_style="color: red; font-size: 12px;"
                                            id="cd_bxgsmc"></font>
                                </td>
                                <td width="20%" align="right" class="t-bg">保险金额</td>
                                <td><input style="width: 200px" type="text" name="cd_bxje" class="_input"
                                           onblur="checkcd_bxje()"/>&nbsp;（元）&nbsp;
                                    <font
                                            style="color: red; font-size: 12px;"
                                            mce_style="color: red; font-size: 12px;"
                                            id="cd_bxje"></font>
                                </td>
                            </tr>
                            <tr>
                                <td width="20%" align="right" class="t-bg">保单日期</td>
                                <td colspan="3"><input style="width: 200px" name="cd_bdrq" class="_input Wdate"
                                                       type="text" onFocus="WdatePicker()" style="width:200px" readonly
                                                       onblur="checkcd_bdrq()">
                                    <font
                                            style="color: red; font-size: 12px;"
                                            mce_style="color: red; font-size: 12px;"
                                            id="cd_bdrq"></font>
                                </td>
                            </tr>
                            <tr>
                                <td width="20%" align="right" class="t-bg">保险项目（第三者责任险）</td>
                                <td colspan="3">
                                    <table align="left">
                                        <tr>
                                            <td><input type="checkbox" name="cd_bxxm" value="1"/><font color=green>车辆损失险:</font>&nbsp;
                                            </td>
                                            <td><input style="width: 200px" type="text" name="cd_clssx" class="_input"
                                                       onblur="checkcd_clssx()"/>&nbsp;（元）&nbsp;
                                                <font
                                                        style="color: red; font-size: 12px;"
                                                        mce_style="color: red; font-size: 12px;"
                                                        id="cd_clssx"></font></td>
                                        </tr>
                                        <tr>
                                            <td><input type="checkbox" name="cd_bxxm" value="2"/><font color=green>全车盗抢险:</font>&nbsp;
                                            </td>
                                            <td><input style="width: 200px" type="text" name="cd_qcdqx" class="_input"
                                                       onblur="checkcd_qcdqx()"/>&nbsp;（元）&nbsp;
                                                <font
                                                        style="color: red; font-size: 12px;"
                                                        mce_style="color: red; font-size: 12px;"
                                                        id="cd_qcdqx"></font></td>
                                        </tr>
                                        <tr>
                                            <td><input type="checkbox" name="cd_bxxm" value="3"/><font color=green>自燃损失险:</font>&nbsp;
                                            </td>
                                            <td><input style="width: 200px" type="text" name="cd_zrssx" class="_input"
                                                       onblur="checkcd_zrssx()"/>&nbsp;（元）&nbsp;
                                                <font
                                                        style="color: red; font-size: 12px;"
                                                        mce_style="color: red; font-size: 12px;"
                                                        id="cd_zrssx"></font></td>
                                        </tr>
                                        <tr>
                                            <td><input type="checkbox" name="cd_bxxm" value="4"/><font color=green>不计免赔特约险:</font>&nbsp;
                                            </td>
                                            <td><input style="width: 200px" type="text" name="cd_bjmptyx" class="_input"
                                                       onblur="checkcd_bjmptyx()"/>&nbsp;（元）&nbsp;
                                                <font
                                                        style="color: red; font-size: 12px;"
                                                        mce_style="color: red; font-size: 12px;"
                                                        id="cd_bjmptyx"></font></td>
                                        </tr>
                                        <tr>
                                            <td><input type="checkbox" name="cd_bxxm" value="5"/><font
                                                    color=green>其他保险:</font>&nbsp;</td>
                                            <td><textarea style="width: 300px;" cols="300" rows="3" type="text"
                                                          name="cd_qtbxmc" id="cd_qtbxmc1" class="_input"></textarea>&nbsp;&nbsp;
                                                <font
                                                        style="color: red; font-size: 12px;"
                                                        mce_style="color: red; font-size: 12px;"
                                                        id="cd_qtbxmc"></font></td>

                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="menuParent">
                    <div class="ListTitlePanel">
                        <div class="ListTitle">
                            <table align="left">
                                <tr style="background:url(__PUBLIC__/Images/t-bg.png)">
                                    <td width="20%" align="center"><b>贷款信息</b></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="menuList" style="display: none;">
                        <table align="left" id="dkxx">
                            <tr>
                                <td width="20%" align="right" class="t-bg">贷款银行</td>
                                <td><input style="width: 200px" type="text" name="cd_dkyh" class="_input"
                                           onblur="checkcd_dkyh()"/>
                                    <font
                                            style="color: red; font-size: 12px;"
                                            mce_style="color: red; font-size: 12px;"
                                            id="cd_dkyh"></font>
                                </td>
                                <td width="20%" align="right" class="t-bg">还款卡号</td>
                                <td><input style="width: 200px" type="text" name="cd_hkkh" class="_input"
                                           onblur="checkcd_hkkh()"/>
                                    <font
                                            style="color: red; font-size: 12px;"
                                            mce_style="color: red; font-size: 12px;"
                                            id="cd_hkkh"></font>
                                </td>
                            </tr>
                            <tr>
                                <td width="20%" align="right" class="t-bg">贷款金额</td>
                                <td><input style="width: 200px" type="text" name="cd_dkje" class="_input"
                                           onblur="checkcd_dkje()"/>&nbsp;（万元）&nbsp;
                                    <font
                                            style="color: red; font-size: 12px;"
                                            mce_style="color: red; font-size: 12px;"
                                            id="cd_dkje"></font>
                                </td>
                                <td width="20%" align="right" class="t-bg"></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td width="20%" align="right" class="t-bg">贷款起始日期</td>
                                <td><input style="width: 200px" name="cd_dkffr" id="cd_dkffr" class="_input Wdate"
                                           type="text" onFocus="WdatePicker()" readonly
                                           onblur="checkcd_dkffr()">
                                    <font
                                            style="color: red; font-size: 12px;"
                                            mce_style="color: red; font-size: 12px;"
                                            id="dkffr"></font>
                                </td>
                                <td width="20%" align="right" class="t-bg">贷款结束日期</td>
                                <td><input style="width: 200px" name="cd_dkdqr" id="cd_dkdqr" class="_input Wdate"
                                           type="text" onFocus="WdatePicker()" readonly
                                           onblur="checkcd_dkdqr()">
                                    <font
                                            style="color: red; font-size: 12px;"
                                            mce_style="color: red; font-size: 12px;"
                                            id="dkdqr"></font>
                                </td>
                            </tr>
                            <tr>
                                <td width="20%" align="right" class="t-bg">贷款利率</td>
                                <td><input style="width: 200px" type="text" name="cd_dkbl" class="_input"
                                           onblur="checkcd_dkbl()"/>&nbsp;‰&nbsp;
                                    <font
                                            style="color: red; font-size: 12px;"
                                            mce_style="color: red; font-size: 12px;"
                                            id="cd_dkbl"></font>
                                </td>
                                <td width="20%" align="right" class="t-bg">还款方式</td>
                                <td>
                                    <input type="radio" name="cd_hkfs" value="1"/><font color=green>等额本息</font>&nbsp;
                                    <input type="radio" name="cd_hkfs" value="2"/><font color=green>等额本金</font>&nbsp;
                                    <input type="radio" name="cd_hkfs" value="3"/><font color=green>按月还息到期还本</font>
                                </td>
                            </tr>
                            <tr>
                                <td width="20%" align="right" class="t-bg">利息计算</td>
                                <td>
                                    <button type="button" value="计算" onclick="callx()" class="btn btn-primary"
                                            style="width:120px">计算
                                    </button>
                                </td>
                                <td width="20%" align="right" class="t-bg"></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td width="20%" align="right" class="t-bg">利息总额</td>
                                <td>
                                    <input style="width: 200px;" type="text" id="lxze" readonly class="_input"
                                           style="width:200px"/>
                                </td>
                                <td width="20%" align="right" class="t-bg">累计还款总额</td>
                                <td>
                                    <input style="width: 200px;" type="text" id="ljhkze" readonly class="_input"
                                           style="width:200px"/>
                                </td>
                            </tr>
                        </table>

                    </div>
                </div>
                <div class="menuParent">
                    <div class="ListTitlePanel">
                        <div class="ListTitle">
                            <table align="left">
                                <tr style="background:url(__PUBLIC__/Images/t-bg.png)">
                                    <td width="20%" align="center"><b>其他信息</b></td>

                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="menuList" style="display: none;">
                        <table align="left" id="qtxx">
                            <tr>
                                <td width="20%" align="right" class="t-bg">返利备注</td>
                                <td><textarea type="text" id="cd_flbz" name="cd_flbz" cols="100" rows="5"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td width="20%" align="right" class="t-bg">上传影印件</td>
                                <td>
                                    <div class="container1">
                                        <div class="row yywj_box" id="yywj">

                                        </div>
                                        <div class="form-group">
                                            <button type="button" class="btn btn-primary" id="select">选择文件</button>
                                            <input hidden="true" type="file" id="fileselect" class="form-control"
                                                   name="fileselect[]"
                                                   multiple="multiple"/>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <table align="left">
                    <td align="center">
                        <button type="button" class="btn btn-primary" value="确定提交" id="send-btn"/>
                        确定提交
                    </td>
                </table>
        </div>
    </form>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="__PUBLIC__/js/jquery/jquery-1.11.3.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="__PUBLIC__/bootstrap-3.3.4/js/bootstrap.min.js"></script>

    <!-- 引入uploadify的js代码 -->
    <script src="__PUBLIC__/uploadify/jquery.uploadify.min.js"></script>

    <!-- 复制专用插件 -->
    <script src="__PUBLIC__/js/jquery.zclip/jquery.zclip.js"></script>
    <!-- 引入livequery 用于新增对象方法绑定 -->
    <script src="__PUBLIC__/js/jquery.livequery.js"></script>
    <script src="__PUBLIC__/processbar/spin.min.js"></script>
    <script> var handleUrl = '<{:U("Customercd/do_cdyw")}>';</script>
    <script> var yywj = new Array();
    var opts = {
        lines: 13, // 花瓣数目
        length: 20, // 花瓣长度
        width: 10, // 花瓣宽度
        radius: 30, // 花瓣距中心半径
        corners: 1, // 花瓣圆滑度 (0-1)
        rotate: 0, // 花瓣旋转角度
        direction: 1, // 花瓣旋转方向 1: 顺时针, -1: 逆时针
        color: '#5882FA', // 花瓣颜色
        speed: 1, // 花瓣旋转速度
        trail: 60, // 花瓣旋转时的拖影(百分比)
        shadow: false, // 花瓣是否显示阴影
        hwaccel: false, //spinner 是否启用硬件加速及高速旋转
        className: 'spinner', // spinner css 样式名称
        zIndex: 2e9, // spinner的z轴 (默认是2000000000)
        top: 'auto', // spinner 相对父容器Top定位 单位 px
        left: 'auto'// spinner 相对父容器Left定位 单位 px
    };

    var spinner = new Spinner(opts);</script>
    <script>
        $('#send-btn').click(function () {
            var cd_name = $('input[name = cd_name]').val();
            var cd_cardid = $('input[name = cd_cardid]').val();
            var cd_clppxh = $('input[name = cd_clppxh]').val();
            var cd_cph = $('input[name = cd_cph]').val();
            var cd_djh = $('input[name = cd_djh]').val();
            var cd_clys = $('input[name = cd_clys]').val();
            var cd_fjrq = $('input[name = cd_fjrq]').val();
            var cd_dkxx = $('input[name = cd_dkxx]').val();
            var cd_bxgsmc = $('input[name = cd_bxgsmc]').val();
            var cd_bxje = $('input[name = cd_bxje]').val();
            var cd_bdrq = $('input[name = cd_bdrq]').val();
            var cd_dkyh = $('input[name = cd_dkyh]').val();
            var cd_hkkh = $('input[name = cd_hkkh]').val();
            var cd_dkje = $('input[name = cd_dkje]').val();
            var cd_dkqx = $('input[name = cd_dkqx]').val();
            var cd_dkffr = $('input[name = cd_dkffr]').val();
            var cd_dkdqr = $('input[name = cd_dkdqr]').val();
            var cd_dkbl = $('input[name = cd_dkbl]').val();
            var cd_hkfs = $('input[name = cd_hkfs]:checked').val();
            var cd_flbz = $('#cd_flbz').val();
            var cd_clssx = '';
            var cd_qcdqx = '';
            var cd_zrssx = '';
            var cd_bjmptyx = '';
            var cd_qtbxmc = '';
            var cd_qtbxje = '';
            $("input[name='cd_bxxm']:checkbox:checked").each(function () {
                if ($(this).val() == 1) {
                    cd_clssx = $('input[name = cd_clssx]').val();
                } else if ($(this).val() == 2) {
                    cd_qcdqx = $('input[name = cd_qcdqx]').val();
                } else if ($(this).val() == 3) {
                    cd_zrssx = $('input[name = cd_zrssx]').val();
                } else if ($(this).val() == 4) {
                    cd_bjmptyx = $('input[name = cd_bjmptyx]').val();
                } else if ($(this).val() == 5) {
                    cd_qtbxmc = $('#cd_qtbxmc1').val();
                    cd_qtbxje = $('input[name = cd_qtbxje]').val();
                }
            })
            if (checkdata()) {
                document.getElementById('send-btn').disabled = true;
                $.post(handleUrl, {
                    cd_name: cd_name,
                    cd_cardid: cd_cardid,
                    cd_clppxh: cd_clppxh,
                    cd_cph: cd_cph,
                    cd_djh: cd_djh,
                    cd_clys: cd_clys,
                    cd_fjrq: cd_fjrq,
                    cd_dkxx: cd_dkxx,
                    cd_bxgsmc: cd_bxgsmc,
                    cd_bxje: cd_bxje,
                    cd_bdrq: cd_bdrq,
                    cd_clssx: cd_clssx,
                    cd_qcdqx: cd_qcdqx,
                    cd_zrssx: cd_zrssx,
                    cd_bjmptyx: cd_bjmptyx,
                    cd_qtbxje: cd_qtbxje,
                    cd_qtbxmc: cd_qtbxmc,
                    cd_dkyh: cd_dkyh,
                    cd_hkkh: cd_hkkh,
                    cd_dkje: cd_dkje,
                    cd_dkqx: cd_dkqx,
                    cd_dkffr: cd_dkffr,
                    cd_dkdqr: cd_dkdqr,
                    cd_dkbl: cd_dkbl,
                    cd_flbz: cd_flbz,
                    cd_yywj: yywj,
                    cd_hkfs: cd_hkfs
                }, function (returndata) {
                    document.getElementById('send-btn').disabled = false;
                    if (returndata.status) {
                        alert('添加成功');
                        window.location.href = "<{:U('Index/main')}>";
                    } else {
                        alert('添加失败，错误：' + returndata.error);
                    }
                }, 'json');
            } else {
                alert('填写的信息错误或者不完整，请检查');
                document.getElementById('send-btn').disabled = false;
            }
        })
    </script>
    <script>
        $(function () {
            $('#select').click(function (event) {
                $('#fileselect').click();
            });
            //选择文件
            $('#fileselect').change(function (event) {
                event.preventDefault();
                var n = event.target.files.length;
                var file;
                var type = "cd_yywj";
                for (var i = 0; i < n; i++) {
                    file = event.target.files[i];
                                        NProgress.start();                     setTimeout(function(){html5up(file,type);},1000);
                }
            });
            //上传操作
            function html5up(file, type) {
                /* Act on the event */
                var name = file.name;
                spinner.spin(document.getElementById('yywj_box'));
                var size = file.size;
                var shardSize = 5 * 1024 * 1024;    //以2MB为一个分片
                var shardCount = Math.ceil(size / shardSize);  //总片数
                var chunk = 0;
                if (size > shardSize) {
                    chunk = 1;
                }
                for (var i = 0; i < shardCount; ++i) {
                    var start = i * shardSize;
                    var end = Math.min(size, start + shardSize);
                    var form_data = new FormData();
                    form_data.append('timestamp', "<{$time}>");
                    form_data.append('token', '<{:md5("unique_salt".$time)}>');
                    form_data.append("filetype", type);
                    form_data.append("data", file.slice(start, end));  //slice方法用于切出文件的一部分
                    form_data.append("name", name);
                    form_data.append("total", shardCount);  //总片数
                    form_data.append("index", i + 1);        //当前是第几片
                    form_data.append("chunk", chunk);
                    $.ajax({
                        url: '__APP__/Upload/upload',
                        type: 'POST',
                        // dataType: 'default: Intelligent Guess (Other values: xml, json, script, or html)',
                        async: false,
                        processData: false,
                        contentType: false,
                        data: form_data
                    })
                            .done(function (data) {
                                // alert(data);
                                NProgress.done();
                                if (!data.status) {
                                    return false;
                                }
                                yywj[yywj.length] = data.savepath + data.savename;
                                put_img(data.savepath, data.savename);//添加图片到img_box
                                console.log("success");
                            })
                            .fail(function () {
                                console.log("error");
                            })
                            .always(function () {
                                console.log("complete");
                                spinner.spin();
                            });
                }
            }

            //添加图片到img_box
            function put_img(savepath, savename, type) {
                savename = savename.substring(0, savename.length - 1);
                var path = savepath + savename;
                var img_url = "__ROOT__" + path.substring(1);
                var new_img = '<div class="col-md-3">';
                var extStart = path.lastIndexOf(".");
                var ext = path.substring(extStart, path.length).toUpperCase();
                if (ext != ".BMP" && ext != ".PNG" && ext != ".GIF" && ext != ".JPG" && ext != ".JPEG") {
                    new_img += '<span style="background-color: #838383">' + savename + '</span>'
                    new_img += '<img style="display:none" src="' + img_url + '" alt="' + savename + '" class="img">';
                    new_img += '<div class="img_ctrl">';
                    new_img += '<span class="glyphicon glyphicon-cloud-download btn" data-toggle="tooltip" data-placement="bottom" title="下载链接地址" aria-hidden="true"></span>';
                    new_img += '<span class="glyphicon glyphicon-trash btn" data-toggle="tooltip" data-placement="bottom" title="删除文件" aria-hidden="true"></span>';
                    new_img += '</div>';
                    new_img += '<div class="img_name">';
                    new_img += '<form action="" class="form-inline">';
                    new_img += '<input type="text" class="form-control input-sm savename" value="' + savename + '">';
                    new_img += '<button class="btn btn-primary btn-sm save inline-block">保存</button>';
                    new_img += '</form>';
                    new_img += '</div>';
                    new_img += '</div>';
                } else {
                    new_img += '<img src="' + img_url + '" alt="' + savename + '" class="img">';
                    new_img += '<div class="img_ctrl">';
                    new_img += '<span class="glyphicon glyphicon-cloud-download btn" data-toggle="tooltip" data-placement="bottom" title="下载链接地址" aria-hidden="true"></span>';
                    new_img += '<span class="glyphicon glyphicon-trash btn" data-toggle="tooltip" data-placement="bottom" title="删除文件" aria-hidden="true"></span>';
                    new_img += '</div>';
                    new_img += '<div class="img_name">';
                    new_img += '<form action="" class="form-inline">';
                    new_img += '<input type="text" class="form-control input-sm savename" value="' + savename + '">';
                    new_img += '<button class="btn btn-primary btn-sm save inline-block">保存</button>';
                    new_img += '</form>';
                    new_img += '</div>';
                    new_img += '</div>';
                }

                $('.yywj_box').append(new_img);

            }

            //复制图片地址
            $('.glyphicon-cloud-download').livequery(function () {
                $(this).zclip({
                    path: '__PUBLIC__/js/jquery.zclip/ZeroClipboard.swf',
                    copy: function () {
                        return "yywjtp://" + "<{$Think.server.HTTP_HOST}>" + $(this).parents('div.col-md-3').find('.img').attr('src');
                    },
                    afterCopy: function () {
                        alert('成功复制图片地址');
                    },
                });
            });


            //调出修改标题input
            $(document).on('click', '.glyphicon-tag', function (event) {
                var div = $(this).parents('div.col-md-3');
                var img_name = div.find('.img_name');
                img_name.fadeToggle();
            });

            //图片删除
            $(document).on('click', '.glyphicon-trash', function (event) {
                event.preventDefault();
                /* Act on the event */
                var div = $(this).parents('div.col-md-3');
                var img_url = div.find('.img').attr('src');
                var len = ("__ROOT__").length;
                var url = "." + img_url.substring(len, img_url.length);
                $.ajax({
                    url: '<{:U("Upload/del",null,false)}>',
                    type: 'POST',
                    // dataType: 'default: Intelligent Guess (Other values: xml, json, script, or yywjml)',
                    data: {url: img_url},
                    success: function (data) {
                        if (!data['status']) {
                            alert(data['info']);
                            return false;
                        } else {
                            alert(data['info']);
                            yywj.splice($.inArray(url, yywj), 1);
                            div.fadeOut(2000);
                            div.remove();
                        }
                        ;
                    }
                });
            });

            //图片放大预览
            $(document).on('click', '.img', function (event) {
                event.preventDefault();
                /* Act on the event */
                var img_url = $(this).attr('src');
                $('#modal').modal('show');
                $('#img_show').attr('src', img_url);
            });

            //点击modal自动隐藏
            $('#modal').click(function (event) {
                $(this).modal('hide');
            });
        });
    </script>

</div>
<include file="Public:customer_footer"/>